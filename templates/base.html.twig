{% include 'header.html.twig' %}
<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>{% block title %}Welcome!{% endblock %}</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 128 128%22><text y=%221.2em%22 font-size=%2296%22>⚫️</text><text y=%221.3em%22 x=%220.2em%22 font-size=%2276%22 fill=%22%23fff%22>sf</text></svg>">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    {% block stylesheets %}
    {% endblock %}

    {% block javascripts %}
        {% block importmap %}{{ importmap('app') }}{% endblock %}
    {% endblock %}
</head>
<body>
{% block body %}
    <div class="header">
        <p>Bienvenue</p>
    </div>

    <!-- Section des produits -->
    <div class="container py-5">
        <h2 class="text-center mb-5">Nos Produits</h2>
        <div class="row row-cols-1 row-cols-md-4 g-4">
            {% for product in products %}
                <div class="col">
                    <div class="card h-100">
                        {% if product.images|length > 0 %}
                            <img src="{{ asset('uploads/images/' ~ product.images|first.url) }}" class="card-img-top" alt="Image de {{ product.name }}" style="height: 300px; object-fit: cover;">
                        {% else %}
                            <img src="{{ asset('uploads/images/default-image.jpg') }}" class="card-img-top" alt="Image par défaut" style="height: 300px; object-fit: cover;">
                        {% endif %}
                        <div class="card-body text-center">
                            {% if product.status == 'SALE' %}
                                <span class="badge bg-dark position-absolute top-0 end-0 m-2">Promo</span>
                            {% endif %}
                            <h5 class="card-title">{{ product.name }}</h5>
                            <p class="card-text">{{ product.price }} €</p>
{#                            <a href="{{ path('product_show', { 'id': product.id }) }}" class="btn btn-outline-dark">Détails</a>#}
                            <a href="{{ path('cart_add', { 'id': product.id }) }}" class="btn btn-dark btn-add-to-cart">Ajouter au panier</a>
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>
    </div>
    <!-- Fin section des produits -->
{% endblock %}

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js" integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.min.js" integrity="sha384-0pUGZvbkm6XF6gxjEnlmuGrJXVbNuzT9qBBavbLwCsOGabYfZo0T0to5eqruptLy" crossorigin="anonymous"></script>

{# use of AJAX to add products to the cart dynamically#}
<script>
    document.addEventListener('DOMContentLoaded', function () {
        // select all buttons with the class 'btn-add-to-cart'
        document.querySelectorAll('.btn-add-to-cart').forEach(function(button) {
            button.addEventListener('click', function(event) {
                event.preventDefault();

                // target the href attribute of the clicked button
                const url = this.getAttribute('href');

                // Envoie la requête AJAX
                fetch(url, {
                    method: 'GET',
                    headers: {
                        'X-Requested-With': 'XMLHttpRequest'
                    }
                })
                    .then(response => response.json())
                    .then(data => {
                        // update the cart count
                        const cartCountElement = document.querySelector('#cart-count');
                        if (cartCountElement) {
                            cartCountElement.textContent = data.totalItems;
                        }
                    })
                    .catch(error => console.error('Erreur lors de l\'ajout au panier:', error));
            });
        });
    });

</script>

</body>
</html>
{% include 'footer.html.twig' %}
